#summary Porting Android to Sciphone N19 repository structure

= Introduction =

There are various version of Android that you may be attempting to port.  In SVN we have 3 branches for the 3 main Android releases.  Any further branches will be created as interested developers decide to to (eg, porting of the unreleased main android branch)


= Details =

Current status of this sub-project is "work-in-progress".  Android version you will compile will not work on Sciphone N19, and updating it will cause the phone to start up and remain unresponsive.  Use this to compile parts that you want to add or modify, or to work towards fixing the 'patch' to produce flashable output.

To build Android from source follow these steps:

== Branches ==

There are several branches of Android source code.  Choose which one you want to work on.  Available branches that are being worked on here are cupcake (which is release 1.5), donut (release 1.6) and eclair (release 2.1).  Other branches of Android source code are considered, at this stage.

== Procedure ==

=== Prerequisites ===

You need a Linux box configured as required by Android build process (see below).  Further due to armv4t specific toolchains, you must use 32bit version of Linux (therefore there may be issues if you are using MacOS).

n addition to the stock-android requirements, the following debian/ubuntu packages are also required: uboot-mkimage, perl, perlmagick

=== Get Android Source Code ===

Follow the instructions on http://source.android.com/download

When you get to the step 'Initializing a Repo client' make sure you put the branch name you wish to work on.  Eg: 

{{{
$ repo init -u git://android.git.kernel.org/platform/manifest.git -b eclair
}}}

This will get eclair branch of the Android source.  Download and wait for everything to finish.

=== Moving baselines ===

It appears that 'cupcake', 'donut', and 'eclair' branches are, in fact, head branches for these builds.  Therefore, patches we have in subversion here, get outdated, and fail compilation.  Instead of having moving base, we're working towards identifying static tags that we should be working from.   We should have an update in a few days.

=== Get Sciphone N19 patches ===

Using your subversion client, get this projects branch that matches the branch of Android you downloaded:

If you downloaded cupcake, use:
{{{
svn checkout http://custom-android-sciphone-n19.googlecode.com/svn/branches/cupcake_platform_patch n19_cupcake_platform
}}}

If you downloaded donut, use:
{{{
svn checkout http://custom-android-sciphone-n19.googlecode.com/svn/branches/donut_platform_patch n19_donut_platform
}}}

If you downloaded eclair, use:
{{{
svn checkout http://custom-android-sciphone-n19.googlecode.com/svn/branches/eclair_platform_patch n19_eclair_platform
}}}

Copy the files from n19_xxx_platform directory to the directory where you have your "platform" directory checked out from git/repo.

Unzip armv4t specific compilers:
{{{
cd prebuilt/linux-x86/toolchain/
tar jxcf armv4t-android-eabi-4.2.1.tar.bz2
}}}

=== Compiling ===

Run 'make -j4' to build the whole android, from the 'platform' directory.  "-j4" tells make to run 4 processes at the same time.  In case things just 'die' reduce this number.

=== Submit changes back here ===

As you fix / improve the build process, please submit the changes back here.  

Ask for read/write access to subversion via forums (see project home for the link).

Track the files you changed in the 'platform' tree to import them back into subversion.

= Status of Branches =

== Cupcake Port ==

Status: does not compile (anymore).  If anyone is enthusiastic on porting updated version of cupcake, please post a comment to get read/write access, or else don't use this branch

== Donut Port ==

Status: does not compile (anymore).  If anyone is enthusiastic on porting updated version of donut, please post a comment to get read/write access, or else don't use this branch

== Eclair Port ==

<completed> 1. compilation succeeds.

<completed> 2. created system.img is in ext2 format with additional 128Mb of empty space.

<completed> 3. ramdisk.img is in the right format (uboot).

Must have uboot-mkimage package for debian/ubuntu installed (i don't want to waste time on getting this to automatically compile)

<not started> 4. init.rc is not ours.. need to add it under vendor tree, with our settings

<completed> 5. files in /system/etc/modules are copied

<not started> 6. other bits for n19 from /system/etc/ not copied

<completed> 7. adbd and busybox copied, few 'applets' symlinked in /system/bin/ to busybox

<in progress> 8. intended install is 

- system.img onto sdcard, mounted via loop device from init.rc

- data mounted from flash memory

- /data/app and /data/dalvik-cache symbolic linked to /system folders (that reside on the loop device that's a file on sdcard)

<in progress> 9. need to fool vold to believe /sdcard has been mounted

<not started> 10. keypad doesn't work at the moment

<not started> 11. touchscreen doesn't work at the moment

<not started> 12. many other things don't work but can't get to it to check

<completed> 13. creation of boot image work in progress, requires perl with perlmagick / imagemagick installed (rename Android.mk from vendor/sciphone/n19/bootlogo/ if this causes problems)

<not started> 14. fix USB mass storage

<not started> 15. fix telephony

<not started> 16. fix wifi

<not started> 17. fix bluetooth

<not started> 18. import apps